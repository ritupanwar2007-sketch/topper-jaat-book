<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Topper Jaat Book Hub</title>
<style>
body {
    margin: 0;
    font-family: Arial, sans-serif;
    color: #fff;
    background: url('https://images.unsplash.com/photo-1501594907353-3b8d1c0a3e9f') no-repeat center center fixed;
    background-size: cover;
}
.overlay {
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background-color: rgba(0,0,0,0.6);
    z-index: -1;
}
section {
    display: none;
    text-align: center;
    padding: 80px 20px;
}
.active { display: block; }
h1,h2,h3 { margin-bottom: 20px; text-shadow: 2px 2px 4px #000; }
.next-btn {
    padding: 10px 20px;
    font-size: 16px;
    margin-top: 15px;
    cursor: pointer;
    border: none;
    border-radius: 5px;
    background: #ff9800;
    color: #fff;
}
.next-btn:hover { background: #e68900; }
input[type="text"], input[type="number"], input[type="password"], input[type="file"] {
    display: block;
    margin: 10px auto;
    padding: 10px;
    width: 80%;
    border-radius: 5px;
    border: none;
}
.error-msg { color: #ff4c4c; }
.admin-panel {
    margin-top: 20px;
    background: rgba(255,255,255,0.1);
    padding: 15px;
    border-radius: 5px;
    max-width: 600px;
    margin-left: auto;
    margin-right: auto;
    text-align: left;
}
.user-item, .blocked-item, .book-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    background: rgba(255,255,255,0.1);
    padding: 8px 10px;
    margin: 5px 0;
    border-radius: 5px;
}
.user-item button, .blocked-item button, .book-item button {
    margin-left: 5px;
    padding: 5px 10px;
    border-radius: 5px;
    border: none;
    cursor: pointer;
}
.block-btn { background: #f44336; color: #fff; }
.remove-btn { background: #ff5722; color: #fff; }
.unblock-btn { background: #4caf50; color: #fff; }
.open-btn { background: #2196f3; color: #fff; }
.delete-btn { background: #9c27b0; color: #fff; }
.block-btn:hover { background: #d32f2f; }
.remove-btn:hover { background: #e64a19; }
.unblock-btn:hover { background: #388e3c; }
.open-btn:hover { background: #1976d2; }
.delete-btn:hover { background: #7b1fa2; }
.book-list { display: flex; flex-direction: column; gap: 10px; margin-top: 20px; max-width: 500px; margin-left:auto; margin-right:auto; }
</style>
</head>
<body>
<div class="overlay"></div>

<!-- First Page -->
<section id="page1" class="active">
    <h1>Topper Jaat Book Hub</h1>
    <p>Powered by Vishal and Abhishek</p>
    <button class="next-btn" onclick="showPage('page2')">Next</button>
</section>

<!-- Second Page -->
<section id="page2">
    <h2>User Login</h2>
    <input type="text" id="username" placeholder="Enter Name">
    <input type="number" id="userclass" placeholder="Enter Class">
    <button class="next-btn" onclick="userLogin()">Next</button>
    <p id="error" class="error-msg"></p>

    <h2>Admin Login</h2>
    <input type="password" id="adminkey" placeholder="Enter Admin Key">
    <button class="next-btn" onclick="adminLogin()">Admin Panel</button>

    <div id="adminPanel" class="admin-panel" style="display:none;">
        <h3>Active Users:</h3>
        <div id="userList"></div>
        <h3>Blocked Users:</h3>
        <div id="blockedList"></div>
    </div>
</section>

<!-- Third Page -->
<section id="page3">
    <h2>Read Books</h2>
    <div id="readBooks" class="book-list"></div>

    <h2>Upload Book (Admin Only)</h2>
    <input type="password" id="uploadKey" placeholder="Enter Admin Key">
    <button class="next-btn" onclick="showUploadForm()">Unlock Upload</button>

    <div id="uploadForm" style="display:none;">
        <input type="text" id="bookTitle" placeholder="Book Title">
        <input type="file" id="bookFile" accept="application/pdf">
        <button class="next-btn" onclick="uploadBook()">Upload</button>
    </div>
</section>

<script>
// Navigation
function showPage(id) {
    document.querySelectorAll('section').forEach(sec => sec.classList.remove('active'));
    document.getElementById(id).classList.add('active');
}

// Load users, blocked users, and books
let users = JSON.parse(localStorage.getItem('users') || "[]");
let blockedUsers = JSON.parse(localStorage.getItem('blockedUsers') || "[]");
let books = JSON.parse(localStorage.getItem('books') || "[]");

// User login (no duplicates, blocked cannot login)
function userLogin() {
    const name = document.getElementById('username').value.trim();
    const userClass = document.getElementById('userclass').value.trim();
    const error = document.getElementById('error');
    if (!name || !userClass) { error.textContent = "Please enter both name and class."; return; }
    if (userClass != 12) { error.textContent = "Only Class 12 students are allowed."; return; }
    if (blockedUsers.includes(name)) { error.textContent = "You are blocked by admin."; return; }
    if (!users.includes(name)) {
        users.push(name);
        localStorage.setItem('users', JSON.stringify(users));
    }
    displayUsers();
    showPage('page3');
}

// Admin login
function adminLogin() {
    const key = document.getElementById('adminkey').value;
    if (key === "12345678") {
        document.getElementById('adminPanel').style.display = "block";
        displayUsers();
    } else alert("Invalid Admin Key!");
}

// Display users and blocked users
function displayUsers() {
    const userListDiv = document.getElementById('userList');
    const blockedListDiv = document.getElementById('blockedList');
    userListDiv.innerHTML = "";
    blockedListDiv.innerHTML = "";

    users.forEach((user, index) => {
        const div = document.createElement('div');
        div.className = "user-item";
        const span = document.createElement('span');
        span.textContent = user;

        const blockBtn = document.createElement('button');
        blockBtn.textContent = "Block";
        blockBtn.className = "block-btn";
        blockBtn.onclick = () => {
            const key = prompt("Enter Admin Key to block user:");
            if (key === "12345678") {
                blockedUsers.push(user);
                blockedUsers = [...new Set(blockedUsers)];
                users.splice(index,1);
                localStorage.setItem('users', JSON.stringify(users));
                localStorage.setItem('blockedUsers', JSON.stringify(blockedUsers));
                displayUsers();
            } else alert("Invalid Admin Key!");
        };

        const removeBtn = document.createElement('button');
        removeBtn.textContent = "Remove";
        removeBtn.className = "remove-btn";
        removeBtn.onclick = () => {
            const key = prompt("Enter Admin Key to remove user:");
            if (key === "12345678") {
                users.splice(index,1);
                localStorage.setItem('users', JSON.stringify(users));
                displayUsers();
            } else alert("Invalid Admin Key!");
        };

        div.appendChild(span);
        div.appendChild(blockBtn);
        div.appendChild(removeBtn);
        userListDiv.appendChild(div);
    });

    blockedUsers.forEach((user, index) => {
        const div = document.createElement('div');
        div.className = "blocked-item";
        const span = document.createElement('span');
        span.textContent = user;

        const unblockBtn = document.createElement('button');
        unblockBtn.textContent = "Unblock";
        unblockBtn.className = "unblock-btn";
        unblockBtn.onclick = () => {
            const key = prompt("Enter Admin Key to unblock user:");
            if (key === "12345678") {
                users.push(user);
                blockedUsers.splice(index,1);
                localStorage.setItem('users', JSON.stringify(users));
                localStorage.setItem('blockedUsers', JSON.stringify(blockedUsers));
                displayUsers();
            } else alert("Invalid Admin Key!");
        };

        div.appendChild(span);
        div.appendChild(unblockBtn);
        blockedListDiv.appendChild(div);
    });
}

// Upload book (admin key)
function showUploadForm() {
    const key = document.getElementById('uploadKey').value;
    if (key === "12345678") { document.getElementById('uploadForm').style.display = "block"; }
    else alert("Invalid Admin Key!");
}

function uploadBook() {
    const title = document.getElementById('bookTitle').value.trim();
    const fileInput = document.getElementById('bookFile');
    if (!title || fileInput.files.length === 0) { alert("Provide title and PDF file."); return; }

    const file = fileInput.files[0];
    const reader = new FileReader();
    reader.onload = function() {
        books.push({ title: title, data: reader.result, type: file.type });
        localStorage.setItem('books', JSON.stringify(books));
        displayBooks();
        alert("Book uploaded successfully!");
    }
    reader.readAsDataURL(file);
}

// Display books with Open & Delete
function displayBooks() {
    const container = document.getElementById('readBooks');
    container.innerHTML = "";
    books.forEach((book, index) => {
        const div = document.createElement('div');
        div.className = "book-item";

        const span = document.createElement('span');
        span.textContent = book.title;

        const openBtn = document.createElement('button');
        openBtn.textContent = "Open";
        openBtn.className = "open-btn";
        openBtn.onclick = () => {
            const byteString = atob(book.data.split(',')[1]);
            const mimeString = book.data.split(',')[0].split(':')[1].split(';')[0];
            const ab = new ArrayBuffer(byteString.length);
            const ia = new Uint8Array(ab);
            for (let i = 0; i < byteString.length; i++) {
                ia[i] = byteString.charCodeAt(i);
            }
            const blob = new Blob([ab], { type: mimeString });
            const url = URL.createObjectURL(blob);
            window.open(url, "_blank");
        };

        const delBtn = document.createElement('button');
        delBtn.textContent = "Delete";
        delBtn.className = "delete-btn";
        delBtn.onclick = () => {
            const key = prompt("Enter Admin Key to delete book:");
            if (key === "12345678") {
                books.splice(index,1);
                localStorage.setItem('books', JSON.stringify(books));
                displayBooks();
            } else alert("Invalid Admin Key!");
        };

        div.appendChild(span);
        div.appendChild(openBtn);
        div.appendChild(delBtn);

        container.appendChild(div);
    });
}

// Load books on page load
displayBooks();
displayUsers();
</script>
</body>
</html>
